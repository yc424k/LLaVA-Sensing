# LLaVA-NeXT 센서-문학 변환 프로젝트 회의록

**날짜**: 2025-09-03  
**프로젝트**: LLaVA-NeXT 기반 센서 데이터를 문학적 단락으로 변환하는 AI 모델 개발  
**목적**: 로봇의 환경 센서 데이터를 소설가의 '영감'처럼 활용한 문학 생성

---

## 📋 프로젝트 개요

### 연구 목표
- 로봇이 수집한 실세계 센서 데이터(이미지, 온습도, 바람, IMU)를 활용
- 인간 소설가의 '영감'처럼 작용하여 풍부하고 감각적인 문학적 단락 생성
- 모더니즘 소설과 여행기 스타일 학습을 통한 고품질 문학적 표현

### 핵심 센서 구성
- **온습도 센서**: 온도와 습도 측정
- **바람 센서**: 바람 방향만 측정 (속도 정보 없음)
- **IMU 센서**: 가속도계 + 자이로스코프로 로봇 방향 추정
- **이미지**: 기존 LLaVA-NeXT 시각 처리 활용

### 주요 혁신점
- **주관적 바람 계산**: IMU를 통해 로봇 기준 상대적 바람 방향 계산
- **멀티모달 융합**: 각 센서 데이터를 별도 채널로 처리 후 융합
- **문학적 변환**: 센서 데이터 → 감각적 문학 묘사

---

## 🔧 기술적 구현 내용

### 1. 센서 인코더 설계
#### 파일: `environmental_sensor_encoder.py`
- **개별 센서 임베딩**: 온도, 습도, 바람방향, IMU 각각 Neural Network로 인코딩
- **상대 바람 계산**: `compute_robot_relative_wind()` 함수로 로봇 기준 바람방향 계산
- **크로스모달 어텐션**: 5개 센서 모달리티 간 상호작용 학습
- **최종 프로젝션**: LLaVA-NeXT hidden_size(4096)로 매핑

#### 파일: `wind_calculation.py`
- **IMU 필터링**: 노이즈 제거를 위한 이동평균 필터
- **방향 추정**: 가속도계와 자이로스코프 융합으로 로봇 heading 계산
- **8방향 문학적 표현**: "정면에서 마주치는", "뒤에서 떠미는" 등 한국어 감각 표현
- **환경 센서 통합 처리**: 온도, 습도, 바람을 종합한 문학적 컨텍스트 생성

### 2. 데이터셋 생성 파이프라인

#### 코퍼스 기반 접근법 채택
- **데이터 소스**: `/Novel/Modernist_Novel` (202개) + `/Travel_Novel` (201개) = 총 403개 파일
- **실제 처리**: 테스트로 6개 파일 처리 → 1,874개 학습 데이터 생성

#### 핵심 알고리즘: 키워드 기반 감각 분석
```python
# 온도 키워드
'hot': ['hot', 'warm', 'burning', 'blazing', 'scorching']
'cold': ['cold', 'cool', 'chilly', 'freezing', 'icy']

# 습도 키워드  
'humid': ['humid', 'moist', 'damp', 'wet', 'steamy']
'dry': ['dry', 'arid', 'parched', 'dusty']

# 처리 흐름: 키워드 빈도 → 강도 판정 → 센서값 범위 → 랜덤값 생성
```

#### 파일 구조
- `simple_novel_processor.py`: 의존성 없는 기본 처리기
- `novel_corpus_processor.py`: NumPy 등 고급 라이브러리 활용 처리기
- `preprocess_with_args.py`: 통합 실행 스크립트 (두 모드 지원)

### 3. 데이터 최적화

#### 청크 분할 시스템
- **문제**: 93MB 단일 JSON 파일 → 메모리 부담
- **해결**: 100개씩 청크 분할 → 19개 청크 파일 (각 ~190KB)
- **자동화**: 데이터 생성 후 자동 청크 분할 기능 통합

#### 연구 목적 최적화
- **사용자 환경**: LLM 훈련, 논문 출판, 128GB 메모리
- **권장 청크 크기**: 2,500개 (논문 보고에 적절, 효율적 배치 처리)
```bash
python3 preprocess_with_args.py --max_files 202 --chunk_size 2500 --verbose
```

---

## 📊 데이터셋 분석

### 생성된 데이터 구조
```json
{
  "id": "A001_passage_001",
  "sensor_data": {
    "temperature": 23.5,      // °C
    "humidity": 65.2,         // %
    "wind_direction": 1.57,   // radians
    "imu": [0.1, 0.05, 9.8, 0.01, 0.02, 0.1], // [acc_x,y,z, gyro_x,y,z]
    "context": {
      "scenario": "city_walking",
      "time": "afternoon", 
      "weather": "clear"
    }
  },
  "target_paragraph": "실제 문학 텍스트...",
  "metadata": {
    "source_file": "A001_The_Awakening.txt",
    "style_category": "modernist",
    "sensory_analysis": {...}
  }
}
```

### 데이터 품질 지표
- **총 1,874개 예시** (6개 파일 기준)
- **스타일 분포**: 모더니즘 1,048개, 여행기 826개  
- **온도 범위**: 5.0°C ~ 34.5°C
- **습도 범위**: 21.0% ~ 89.4%
- **평균 단락 길이**: 511자

### 전체 데이터 규모 추정
- **403개 파일 처리 시**: 약 125,000개 데이터셋 예상
- **처리 시간**: 10-30분 소요 예상

---

## 🏗️ 아키텍처 통합 계획

### LLaVA-NeXT 확장
1. **기존 구조 분석**: `llava_arch.py`의 `prepare_inputs_labels_for_multimodal()` 함수 확장점 파악
2. **센서 인코더 추가**: 환경 센서를 새로운 모달리티로 통합
3. **builder.py 확장**: 센서 타워 빌더 추가

### 훈련 파이프라인
- **멀티모달 입력**: [이미지] + [센서 데이터] + [텍스트 프롬프트] → [문학적 단락]
- **손실 함수**: 기존 언어 모델링 손실 활용
- **평가 지표**: BLEU, ROUGE, 문학적 품질 평가

---

## 🛠️ 개발된 도구들

### 실행 스크립트
- `preprocess_with_args.py`: 메인 실행 스크립트
- `run_preprocessing.sh`: 배치 처리 스크립트  
- `split_dataset.py`: 청크 분할 유틸리티
- `dataset_reader.py`: 청크 데이터 읽기 도구

### 문서화
- `README.md`: 종합 실행 가이드
- `algorithm_explanation.md`: 알고리즘 상세 설명
- `회의록.md`: 이 파일

---

## ✅ 완료된 작업

1. **✅ LLaVA-NeXT 아키텍처 분석**: 멀티모달 통합 지점 파악
2. **✅ 환경 센서 인코더 설계**: 온습도, 바람, IMU 통합 처리
3. **✅ 로봇 상대 바람 계산**: IMU 기반 주관적 바람 방향 계산
4. **✅ 합성 데이터 생성 파이프라인**: GPT-4/Claude 기반 데이터 생성 시스템
5. **✅ 코퍼스 기반 데이터 생성**: Novel 폴더 403개 파일 활용 시스템
6. **✅ 데이터 전처리 실행 가이드**: README 및 통합 스크립트
7. **✅ 대용량 데이터 청크 분할**: 메모리 효율적 데이터 관리
8. **✅ 데이터 최적화**: 연구 목적에 맞는 청크 크기 결정

---

## 🔄 진행 중인 작업

### 8. LLaVA-NeXT 아키텍처 센서 모달리티 확장
- **상태**: 진행 중
- **내용**: 환경 센서 인코더를 LLaVA-NeXT에 통합
- **다음 단계**: 
  - `builder.py`에 센서 타워 추가
  - `llava_arch.py`에서 센서 처리 로직 통합
  - 멀티모달 어텐션에 센서 채널 추가

---

## 📅 향후 계획

### 9. 훈련 파이프라인 설계
- **목표**: 센서 데이터 → 문학 생성 모델 훈련 시스템
- **구성 요소**:
  - 데이터 로더 (청크 단위 배치 처리)
  - 훈련 루프 (멀티모달 입력 처리)
  - 평가 메트릭 (문학적 품질 측정)
  - 체크포인트 관리

### 추가 개선사항
- **데이터 품질 향상**: 더 정교한 센서-문학 매핑 알고리즘
- **다국어 확장**: 영어, 일본어 문학 코퍼스 추가
- **실시간 생성**: 로봇 센서 데이터 실시간 문학 변환
- **평가 시스템**: 문학 전문가 평가 + 자동 평가 결합

---

## 💡 주요 인사이트

### 기술적 혁신
1. **센서 융합의 문학적 활용**: 기존 센서 융합이 객관적 정보 추출에 집중했다면, 이 프로젝트는 주관적 감각 표현에 활용
2. **상대적 환경 인식**: 로봇 기준의 주관적 바람 방향 계산으로 인간적 감각 모사
3. **코퍼스 기반 학습**: 실제 문학 작품에서 추출한 자연스러운 표현 활용

### 연구 가치  
1. **로봇 감성 표현**: 로봇이 환경을 인간적으로 표현하는 새로운 접근법
2. **멀티모달 창작**: 센서 데이터를 창작의 영감으로 활용하는 AI 시스템
3. **문화적 AI**: 특정 문화(한국어)의 감각 표현을 학습하는 모델

---

## 🔧 개발 환경 및 도구

### 사용 기술
- **Python 3**: 기본 개발 언어
- **PyTorch**: 딥러닝 프레임워크 (LLaVA-NeXT 기반)
- **JSON**: 데이터 저장 포맷
- **Bash**: 자동화 스크립트

### 의존성 관리
- **Simple 모드**: 표준 라이브러리만 사용 (numpy 없이)
- **Advanced 모드**: numpy, pandas, nltk, scikit-learn 필요

### 데이터 관리
- **원본 코퍼스**: 403개 텍스트 파일 (93MB)
- **처리 데이터**: 청크 단위 JSON 파일들
- **백업 전략**: 원본 유지 + 청크 분산 저장

---

## 📞 향후 협업 방안

### 논문 출판 계획
- **학회**: AI/NLP 관련 국제 학회 (ACL, EMNLP, ICML 등)
- **주제**: "Sensor-to-Literature: Environmental Perception as Creative Inspiration"
- **기여도**: 새로운 멀티모달 창작 패러다임 제시

### 데이터셋 공개
- **GitHub**: 전처리 코드 및 도구 오픈소스
- **Dataset**: 생성된 센서-문학 데이터셋 공개 (저작권 고려)
- **재현성**: 완전한 실행 가이드 및 환경 설정 제공

---

**마지막 업데이트**: 2025-09-03  
**다음 회의**: LLaVA-NeXT 아키텍처 센서 통합 완료 후